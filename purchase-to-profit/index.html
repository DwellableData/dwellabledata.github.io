<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Purchase to Profit</title>
		<script type="text/javascript" src="../d3/d3.v3.min.js"></script>
		<style type="text/css">
			/* No style rules here yet */		
		</style>
	</head>
	<body>

<script type="text/javascript">

	//Width and height
	var w = 700;
	var h = 625;

	//Define map projection
	var projection = d3.geo.albersUsa()
						   .translate([w/2, h/2])
						   .scale([900]);

	//Define path generator
	var path = d3.geo.path()
					 .projection(projection);
					 
	//Define Legend Labels
	var legend_labels = ["0-1", "2-3", "4-5", "6-7", "8-9", "10+"];

	//Define quantize scale to sort data values into buckets of color
	var color = d3.scale.quantize()
						.range(['rgb(140,81,10)','rgb(216,179,101)','rgb(246,232,195)','rgb(199,234,229)','rgb(90,180,172)','rgb(1,102,94)']);
						//Colors taken from colorbrewer.js, included in the D3 download

	//Create SVG element
	var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h);

	//Load in data
	d3.tsv("statemediandata.tsv", function(data) {

		//Set input domain for color scale
		color.domain([
			d3.min(data, function(d) { return d.BreakevenYears; }), 
			d3.max(data, function(d) { return d.BreakevenYears; })
		]);

		//Load in GeoJSON data
		d3.json("us-states.json", function(json) {

			console.log(json)

			//Merge the ag. data and GeoJSON
			//Loop through once for each ag. data value
			for (var i = 0; i < data.length; i++) {
		
				//Grab state name
				var dataState = data[i].State;
				
				//Grab data value, and convert from string to float
				var dataValue = parseFloat(data[i].BreakevenYears);
		
				//Find the corresponding state inside the GeoJSON
				for (var j = 0; j < json.features.length; j++) {
				
					var jsonState = json.features[j].properties.name;
		
					if (dataState === jsonState) {
				
						//Copy the data value into the JSON
						json.features[j].properties.value = dataValue;
						
						//Stop looking through the JSON
						break;
						
					}
				}		
			}

			//Bind data and create one path per GeoJSON feature
			svg.selectAll("path")
			   .data(json.features)
			   .enter()
			   .append("path")
			   .attr("d", path)
			   .style("fill", function(d) {
			   		//Get data value
			   		var value = d.properties.BreakevenYears;
			   		
			   		if (value) {
			   			//If value exists…
				   		return color(value);
			   		} else {
			   			//If value is undefined…
				   		return "#ccc";
			   		}
			   });

		});

	});
	
</script>


	</body>
</html>