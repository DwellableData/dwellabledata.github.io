<!DOCTYPE html>
<meta charset="utf-8">
<style>
  .state{
    fill: none;
    stroke: #696969;
    stroke-width: 1;
  }
  .state:hover{
    fill-opacity:0.5;
  }
  .labelname{
    font-size: 11px;
    font-weight: bold;
    text-anchor: middle;
    text-align: center;
    color: black;
  }
  .labeldescription{
    font-size: 10px;
    font-weight: bold;
    text-anchor: middle;
    text-align: center;
    color: black;
  }
  .legend {
    font-size: 12px;
  }
  #tooltip {   
    position: absolute;           
    text-align: center;
    padding: 20px;             
    margin: 10px;
    font: 12px sans-serif;        
    background: lightsteelblue;   
    border: 1px;      
    border-radius: 2px;           
    pointer-events: none;         
  }
  #tooltip h4{
    margin:0;
    font-size:14px;
  }
  #tooltip{
    background:rgba(0,0,0,0.9);
    border:1px solid grey;
    border-radius:5px;
    font-size:12px;
    width:auto;
    padding:4px;
    color:white;
    opacity:0;
    white-space: nowrap;
  }
  #tooltip table{
    table-layout:fixed;
  }
  #tooltip tr td{
    padding:0;
    margin:0;
  }
  #tooltip tr td:nth-child(1){
    width:50px;
  }
  #tooltip tr td:nth-child(2){
    text-align:center;
  }
</style>
<body>

<div id="tooltip"></div>

<script type="text/javascript" src="statehover.js"></script>

<script type="text/javascript" src="../d3/d3.v3.min.js"></script>
<script type="text/javascript" src="../d3/d3.v3.min.js"></script>

<script>


  var width = 800;
  var height = 450;

  var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
    .attr("id", "statesvg")
    .style("margin", "10px auto");

    var projection = d3.geo.albersUsa()
      .scale(800)
      .translate([width/2, height/2]);

  var colors = ['rgb(252,141,89)','rgb(254,224,144)','rgb(255,255,191)','rgb(224,243,248)','rgb(145,191,219)','rgb(69,117,180)'];
  var legend_labels = ['0-1', '2-3', '4-5', '6-7', '8-9', '10+']

  var format = d3.format("$,");

  function tooltipHtml(d){ /* function to create html content string in tooltip div. */
    return "<h4>"+d["label"]+"</h4><table>"+
      "<tr><td>Break even (yrs): </td><td>"+(d["years"])+"</td></tr>"+
      "<tr><td>Home cost: </td><td>"+format(d["home"])+"</td></tr>"+
      "<tr><td>Rate per night: </td><td>"+(format(d["rent"]))+"</td></tr>"+
      "</table>";
  }

  
  d3.tsv("statemediandata.tsv", function(d) {

    var statedata = {};

    d.forEach(function(state) {
      var shade = new String();

      if (state.years < 2) {
        shade = colors[5];
      } else if ( state.years >=2 && state.years <4 ) {
        shade = colors[4];
      } else if ( state.years >=4 && state.years <6 ) {
        shade = colors[3];
      } else if ( state.years >=6 && state.years <8 ) {
        shade = colors[2];
      } else if ( state.years >=8 && state.years <10) {
        shade = colors[1];
      } else {
        shade = colors[0];
      };

      var location = [+state.longitude, +state.latitude];
      var position = projection(location);

      statedata[state.state]={state: state.state, label: state.label, rent: state.rent, years: state.years, home: state.home, latitude:  position[1], longitude: position[0], color:shade}; 

    }); 

    var legend = svg.selectAll("g.legend")
      .data(legend_labels)
      .enter().append("g")
      .attr("class", "legend")

    var l_width = 20, l_height = 20;

    legend.append("rect")
      .attr("x", function(d, i){ return width - l_width;})
      .attr("y", function(d, i){ return height - (i*l_height) - 2*l_width;})
      .attr("width", l_width)
      .attr("height", l_height)
      .style("fill", function(d, i) { return colors[i]; });

    legend.append("text")
      .attr("x", function(d, i){ return width - l_width - 60;})
      .attr("y", function(d, i){ return height - (i*l_height) - l_height - 4;})
      .text(function(d, i){ return legend_labels[5-i]+" years"; });

   /* draw states on id #statesvg */ 
    usa.draw("#statesvg", statedata, tooltipHtml, projection);

  });


</script>

</body>